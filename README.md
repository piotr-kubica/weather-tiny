[![Donate with Bitcoin](https://en.cryptobadges.io/badge/micro/bc1qt2sd4ys4q3dh8jk9s72rgcpy8855ydzjx323dd)](https://en.cryptobadges.io/donate/bc1qt2sd4ys4q3dh8jk9s72rgcpy8855ydzjx323dd)
[![Donate](https://img.shields.io/badge/Donate-PayPal-green.svg)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=VEJ9YA2MMH9SA)

# Tiny weather station based on TTGO T5 V2.3.1 (ESP32 with 2.13" e-ink display)

[<img src="/images/esp-weather-station.jpg" width="440"/>](/images/esp-weather-station.jpg) [<img src="/images/weather_mini.jpg" width="350"/>](/images/weather_mini.jpg) 

### This project is licensed under GNU General Public License v2.0
The GNU GPL is the most widely used free software license and has a strong copyleft requirement. When distributing derived works, the source code of the work must be made available under the same license. There are multiple variants of the GNU GPL, each with different requirements.

### Features

- wireless and rechargable
- weather description including temperature, pressure, wind
- rain forecast
- air quality index
- multiple locations
- easy wireless setup using smartphone/PC
- fridge mount
- refreshes every 15 min.

[<img src="/images/weather_mini_features.png" width="518"/>](/images/weather_mini_features.png)

### User guide

#### Device configuration

Turn on device. 
Reset to enable configuration.
Connect to `weather-wifi` device access point.
Go to 192.168.4.1/config if not redirected.
Provide wireless lan ssid and password.
Provide locations for which information should be fetched.
Submit config form.
After a successful validation device displays weather information for given location.


[![YT video thumbnail](/images/yt_thumbnail.png)](https://youtu.be/SJgQPxBXJxA)

#### Device usage
Switch between locations using top left button. \
Refresh current location using top right button. \
Reset device using bottom button. \
Turn on/off device using top switch.
\
[<img src="/images/weather_mini_button_function.png" width="340"/>](/images/weather_mini_button_function.png)


### Hardware
To assemble the device yourself you will need
- TTGO T5 V2.3
- small LiPo battery cell with JST-BEC connector (980mAh 3.7V, size: 50x34x6mm)
- 3D printed case (see: stl files)
- M3 bolt (6mm long) [4]
- magnet 5x12mm (for fridge mount) [5]
- 10k resistor [1]
- thermo sleeve [3]
- small tactile button 4.5x4.5x3mm [2]
- (optional) poly foam or similar to put inside case with battery, so it does not move

[<img src="/images/reset_btn_0.png" width="340"/>](/images/reset_btn_0.png)
[<img src="/images/lipo.png" width="350"/>](/images/lipo.png)


### Assembly
Device comes with two buttons (used for refresh and location change).
The missing reset device button needs to be added by using tactile button and a pull-down resistor.
Create the pull-down resistor by soldering the resistor to GND and pin 34.
Solder the tactile button to pins 34 and 3V3.

[<img src="/images/reset_btn_2.png" width="280"/>](/images/reset_btn_2.png)
[<img src="/images/reset_btn_1.png" width="280"/>](/images/reset_btn_1.png) 

Insert TTGO to the 3D printed case. Connect the LiPo cell. 
Mount the case using M3 bolt.

### Software

#### License
Project source code is licensed under GPL2 (including source code and stl).
This does not include external libraries and used fonts.

#### Installation
##### Setup Arduino IDE to be used with ESP32.
You can do this in this tutorial
https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/

##### Install external libs
- Adafruit GFX Library
- GxEPD.h - includes e-ink screen drivers. I have used GxGDE0213B72B or GxDEPG0213BN depending on device display version 
- ArduinoJson - for handling API responses 
- AsyncTCP - used for API requests
- ESPAsyncWebServer - used for config server
- Preferences - used for data storage
  
Use font files generated by fontconvert which can be found inside libraries/Adafruit_GFX_library/Fonts.
You can also download these fonts (free to use) and use fontconvert tool to create them yourself.

##### API keys
External APIs are used to fetch data. 
These are free to use services:
- https://positionstack.com/ to fetch location position
- https://aqicn.org/api/pl/ for air quality
- https://openweathermap.org/api for weather data
- https://timezonedb.com/api for date and time

Register and obtain the keys. Then replace the api keys in config.h file.

##### Upload sketch to device
Verify and upload the weather_mini.ino sketch.
After successful upload turn on the device and configure it as shown in [device configuration](#device-configuration) section.
See the example output from [serial monitor](monitor_log.txt) for a successful device configuration.

### Support

If you have found this project useful you can buy me a cup of coffee 

[![Donate with Bitcoin](https://en.cryptobadges.io/badge/big/bc1qt2sd4ys4q3dh8jk9s72rgcpy8855ydzjx323dd)](https://en.cryptobadges.io/donate/bc1qt2sd4ys4q3dh8jk9s72rgcpy8855ydzjx323dd)

[![Donate](https://img.shields.io/badge/Donate-PayPal-green.svg)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=VEJ9YA2MMH9SA)

